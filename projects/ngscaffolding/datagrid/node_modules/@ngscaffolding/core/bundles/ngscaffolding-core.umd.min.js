!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@datorama/akita"),require("@ngscaffolding/models"),require("rxjs/operators"),require("rxjs"),require("@angular/common/http"),require("uuid"),require("@auth0/angular-jwt"),require("@angular/router"),require("oidc-client"),require("dateformat"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@ngscaffolding/core",["exports","@angular/core","@datorama/akita","@ngscaffolding/models","rxjs/operators","rxjs","@angular/common/http","uuid","@auth0/angular-jwt","@angular/router","oidc-client","dateformat","@angular/common","@angular/forms"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).ngscaffolding=e.ngscaffolding||{},e.ngscaffolding.core={}),e.ng.core,e.akita,e.models,e.rxjs.operators,e.rxjs,e.ng.common.http,e.uuid,e.angularJwt,e.ng.router,e.oidcClient,e.dateFormatimp,e.ng.common,e.ng.forms)}(this,(function(e,t,n,r,o,i,a,s,u,c,p,l,f,h){"use strict";function d(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var g=d(l),v=function(e,t){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function S(e,t){function n(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function y(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function m(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function b(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}Object.create;function w(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function I(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function j(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(I(arguments[t]));return e}Object.create;e.AppSettingsStore=function(e){function t(){var t=e.call(this,{isInitialised:!1})||this;return console.log("AppSettingsStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.AppSettingsStore.ɵfac=function(t){return new(t||e.AppSettingsStore)},e.AppSettingsStore.ɵprov=t.ɵɵdefineInjectable({token:e.AppSettingsStore,factory:e.AppSettingsStore.ɵfac,providedIn:"root"}),e.AppSettingsStore=y([n.StoreConfig({name:"appSettings",idKey:"name"})],e.AppSettingsStore);var k=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.isInitialised$=n.select((function(e){return e.isInitialised})),n}return S(t,e),t}(n.QueryEntity);k.ɵfac=function(n){return new(n||k)(t.ɵɵinject(e.AppSettingsStore))},k.ɵprov=t.ɵɵdefineInjectable({token:k,factory:k.ɵfac,providedIn:"root"});var A=function(){function e(){this._eventBus=new i.Subject}return e.prototype.broadcast=function(e,t){this._eventBus.next({key:e,data:t})},e.prototype.on=function(e){return this._eventBus.pipe(o.filter((function(t){return t.key===e})),o.map((function(e){return e.data})))},e}();A.ɵfac=function(e){return new(e||A)},A.ɵprov=t.ɵɵdefineInjectable({token:A,factory:A.ɵfac,providedIn:"root"});var E=function(){function e(e){this.broadcast=e}return e.prototype.showMessage=function(e){this.broadcast.broadcast("SHOW_MESSAGE",e)},e}();E.ɵfac=function(e){return new(e||E)(t.ɵɵinject(A))},E.ɵprov=t.ɵɵdefineInjectable({token:E,factory:E.ɵfac,providedIn:"root"}),e.AuthenticationStore=function(e){function t(){var t=e.call(this,{userDetails:r.createBasicUser()})||this;return console.log("AuthenticationStore Constructor"),t}return S(t,e),t}(n.Store),e.AuthenticationStore.ɵfac=function(t){return new(t||e.AuthenticationStore)},e.AuthenticationStore.ɵprov=t.ɵɵdefineInjectable({token:e.AuthenticationStore,factory:e.AuthenticationStore.ɵfac,providedIn:"root"}),e.AuthenticationStore=y([n.StoreConfig({name:"authorisation"})],e.AuthenticationStore);var R=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.authenticated$=n.select((function(e){return e.authenticated})),n.currentUser$=n.select((function(e){return e.userDetails})),n}return S(t,e),t.prototype.isAuthenticated=function(){return n.toBoolean(this.getValue().authenticated)},t.prototype.getUserId=function(){return this.isAuthenticated()&&this.getValue().userDetails?this.getValue().userDetails.userId:null},t.prototype.getUser=function(){return this.getValue().userDetails},t}(n.Query);R.ɵfac=function(n){return new(n||R)(t.ɵɵinject(e.AuthenticationStore))},R.ɵprov=t.ɵɵdefineInjectable({token:R,factory:R.ɵfac,providedIn:"root"});var V=function(){function e(e,t,n,r){this.notification=e,this.appSettingsQuery=t,this.userQuery=n,this.http=r}return e.prototype.error=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=!1),t?console.error("Error "+e):console.error("Method "+t+": Error "+e),n&&this.notification.showMessage({severity:"error",summary:"Error",detail:e.message})},e.prototype.warning=function(e,t){void 0===t&&(t=""),t?console.warn("Warning "+e):console.warn("Method "+t+": Warning "+e)},e.prototype.info=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=null),t?console.info("["+t+"] : "+e,n):console.info("Info : "+e,n)},e}();V.ɵfac=function(e){return new(e||V)(t.ɵɵinject(E),t.ɵɵinject(k),t.ɵɵinject(R),t.ɵɵinject(a.HttpClient))},V.ɵprov=t.ɵɵdefineInjectable({token:V,factory:V.ɵfac,providedIn:"root"});var D=function(){function e(e,t,n,r){this.appSettingsStore=e,this.appSettingsQuery=t,this.logger=n,this.http=r,this.className="AppSettingsService",console.log("AppSettingsService Constructor")}return e.prototype.setValue=function(e,t){this.appSettingsQuery.hasEntity(e)?this.appSettingsStore.update(e,{name:e,value:t}):this.appSettingsStore.add({name:e,value:t}),e===r.AppSettings.apiHome&&this.loadFromServer(t.toString())},e.prototype.getValue=function(e){return this.appSettingsQuery.hasEntity(e)?this.appSettingsQuery.getEntity(e).value:null},e.prototype.loadFromServer=function(e){var t=this;this.appSettingsStore.setLoading(!0),this.http.get(e+"/api/v1/appSettings").pipe(o.timeout(2e4),o.retry(3)).subscribe((function(e){e&&e.forEach((function(e){t.setValue(e.name,e.value)})),t.appSettingsStore.setLoading(!1),t.appSettingsStore.update({isInitialised:!0})}),(function(e){t.appSettingsStore.setLoading(!1)}))},e.prototype.setValues=function(e){var t=this;this.appSettingsStore.setLoading(!0),this.appSettingsStore.update({isInitialised:!1}),e&&Object.keys(e).forEach((function(n){t.logger.info("["+t.className+".loadSettings] Setting Value "+n+" = "+e[n]),t.setValue(n,e[n])})),this.appSettingsStore.setLoading(!1),this.appSettingsStore.update({isInitialised:!0})},e.prototype.getBoolean=function(e){return this.appSettingsQuery.selectEntity(e,(function(e){return e.value}))},e.prototype.getString=function(e){return this.appSettingsQuery.selectEntity(e,(function(e){return e.value}))},e}();D.ɵfac=function(n){return new(n||D)(t.ɵɵinject(e.AppSettingsStore),t.ɵɵinject(k),t.ɵɵinject(V),t.ɵɵinject(a.HttpClient))},D.ɵprov=t.ɵɵdefineInjectable({token:D,factory:D.ɵfac,providedIn:"root"});var Q=function(){function e(e,t,n){this.appSettingsQuery=e,this.userQuery=t,this.http=n}return e.prototype.RecordLog=function(e){var t=this.appSettingsQuery.getEntity(r.AppSettings.apiHome).value;e.logDate||(e.logDate=r.ZuluDateHelper.setGMTDate(new Date)),e.userID||(e.userID=this.userQuery.getUserId());try{this.http.post(t+"/api/v1/applicationLog",e).pipe(o.timeout(3e4),o.retry(3)).subscribe((function(e){}),(function(e){console.log("Unable to send AppLog, offline?")}))}catch(e){console.log("Unable to send AppLog, offline?")}},e}();Q.ɵfac=function(e){return new(e||Q)(t.ɵɵinject(k),t.ɵɵinject(R),t.ɵɵinject(a.HttpClient))},Q.ɵprov=t.ɵɵdefineInjectable({token:Q,factory:Q.ɵfac,providedIn:"root"});var L=function(e){function t(){var t=e.call(this,{})||this;return console.log("AuditLogStore Constructor"),t}return S(t,e),t}(n.EntityStore);L.ɵfac=function(e){return new(e||L)},L.ɵprov=t.ɵɵdefineInjectable({token:L,factory:L.ɵfac,providedIn:"root"}),L=y([n.StoreConfig({name:"auditLog",idKey:"id"})],L);var M=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.allAuditLog=n.getAll(),n}return S(t,e),t}(n.QueryEntity);M.ɵfac=function(e){return new(e||M)(t.ɵɵinject(L))},M.ɵprov=t.ɵɵdefineInjectable({token:M,factory:M.ɵfac,providedIn:"root"});var O=function(){function e(e,t,n,o,i){var a=this;this.auditLogStore=e,this.auditLogQuery=t,this.appSettingsQuery=n,this.userQuery=o,this.http=i,this.polling=3e4,this.retryVal=3,this.isSending=!1,this.defaultLog={},n.selectEntity(r.AppSettings.mobileDefaultPolling).subscribe((function(e){return a.polling=e.value>0?e.value:3e4})),n.selectEntity(r.AppSettings.mobileDefaultRetries).subscribe((function(e){return a.retryVal=e.value>0?e.value:3})),this.StartPolling()}return e.prototype.SetDefault=function(e){this.defaultLog=e},e.prototype.RecordLog=function(e){var t=Object.assign(Object.assign({},this.defaultLog),e);t.id=s.v4(),t.logDate||(t.logDate=r.ZuluDateHelper.setGMTDate(new Date)),t.userID||(t.userID=this.userQuery.getUserId()),this.auditLogStore.add(t)},e.prototype.StartPolling=function(){var e=this;setInterval((function(t){e.isSending||(e.isSending=!0,e.SendLogEntries())}),this.polling)},e.prototype.SendLogEntries=function(){var e=this,t=this.appSettingsQuery.getEntity(r.AppSettings.apiHome).value,n=this.auditLogQuery.getAll();if(n&&n.length>0){var i=n.map((function(e){return e.id}));this.http.post(t+"/api/v1/auditlog",n).pipe(o.timeout(3e4),o.retry(3),o.finalize((function(){e.isSending=!1}))).subscribe((function(t){e.auditLogStore.remove(i)}),(function(e){console.log("Unable to send AppLog, offline?")}))}else this.isSending=!1},e}();O.ɵfac=function(e){return new(e||O)(t.ɵɵinject(L),t.ɵɵinject(M),t.ɵɵinject(k),t.ɵɵinject(R),t.ɵɵinject(a.HttpClient))},O.ɵprov=t.ɵɵdefineInjectable({token:O,factory:O.ɵfac,providedIn:"root"});var C=function(){function e(e,t){this.loader=e,this.injector=t,this.componentRegistry={"lazy-component":{modulePath:"./lazy-components/lazy-components.module#LazyComponentsModule",moduleRef:null}}}return e.prototype.registerComponent=function(e,t){void 0===t&&(t=null),this.componentRegistry[e]||(this.componentRegistry[e]={modulePath:t,moduleRef:null})},e.prototype.loadComponent=function(e){var t=this,n=this.componentRegistry[e];if(!n)throw new Error('Unrecognized component "'+e+'". Make sure it is registered in the component registry');if(n.modulePath){if(n.moduleRef)return new Promise((function(t){t(document.createElement(e))}));var r=n.modulePath;return new Promise((function(o,i){t.loader.load(r).then((function(r){var i=r.create(t.injector).instance;n.moduleRef=i;var a=document.createElement(e);o(a)})).catch((function(e){console.error("error loading module",e),i(e)}))}))}return new Promise((function(t,n){t(document.createElement(e))}))},e}();C.ɵfac=function(e){return new(e||C)(t.ɵɵinject(t.NgModuleFactoryLoader),t.ɵɵinject(t.Injector))},C.ɵprov=t.ɵɵdefineInjectable({token:C,factory:C.ɵfac,providedIn:"root"});var P=function(e){function t(t,n){var r=e.call(this)||this;return r.appSettingsService=t,r.http=n,r}return S(t,e),t.prototype.logError=function(e,t){void 0===t&&(t=null)},t.prototype.processError=function(e,t){void 0===t&&(t=null)},t.prototype.handleError=function(t,n){if(void 0===n&&(n=null),e.prototype.handleError.call(this,t),this.appSettingsService.getValue(r.AppSettings.errorLogConsole)&&console.error(t.message),this.appSettingsService.getValue(r.AppSettings.errorLogServer)){var o=new r.ErrorModel(t);n&&(o.source=n),t.stack&&(o.stackTrace=t.stack);try{this.http.post(this.appSettingsService.getValue(r.AppSettings.apiHome)+"/api/v1/error",o).subscribe((function(e){}),(function(e){console.log("Unable to send Error to Server, offline?")}))}catch(e){console.log("Unable to send Error to Server, offline?")}}this.appSettingsService.getValue(r.AppSettings.errorShowUser)},t}(t.ErrorHandler);P.ɵfac=function(e){return new(e||P)(t.ɵɵinject(D),t.ɵɵinject(a.HttpClient))},P.ɵprov=t.ɵɵdefineInjectable({token:P,factory:P.ɵfac,providedIn:"root"}),e.DataSourceStore=function(e){function t(){var t=e.call(this,{isInitialised:!1})||this;return console.log("DataSourceStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.DataSourceStore.ɵfac=function(t){return new(t||e.DataSourceStore)},e.DataSourceStore.ɵprov=t.ɵɵdefineInjectable({token:e.DataSourceStore,factory:e.DataSourceStore.ɵfac,providedIn:"root"}),e.DataSourceStore=y([n.StoreConfig({name:"dataSource",idKey:"key"})],e.DataSourceStore);var H=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.isInitialised$=n.select((function(e){return e.isInitialised})),n}return S(t,e),t}(n.QueryEntity);H.ɵfac=function(n){return new(n||H)(t.ɵɵinject(e.DataSourceStore))},H.ɵprov=t.ɵɵdefineInjectable({token:H,factory:H.ɵfac,providedIn:"root"});var x=function(){function e(e,t,n,r,o,i){this.http=e,this.dataSourceStore=t,this.dataSourceQuery=n,this.appSettingsService=r,this.appAuditService=o,this.logger=i,this.className="DataSourceService",this.inflightRequests=new Map}return e.prototype.decorateInput=function(e){return null},e.prototype.getDataSource=function(e){var t=this,n=this.getKey(e);e.forceRefresh&&this.dataSourceStore.remove(n);var a=this.dataSourceQuery.getEntity(n);if(a){if(a.expiresWhen>new Date)return i.of(a);this.dataSourceStore.remove(n)}if(this.inflightRequests.has(n))return this.inflightRequests.get(n);var s=new FormData;if(s.append("dataSourceRequest",JSON.stringify(e)),e.fileNames){var u=0;e.fileNames.forEach((function(e){s.append("file-"+u++,e,e.name)}))}var c={entity:"DataSource Call",action:n,values:{filterValues:e.filterValues,inputData:e.inputData}};return this.logger.info("Calling Datasource "+e.name,null,c.values),this.inflightRequests.set(n,new i.Observable((function(e){t.http.post(t.appSettingsService.getValue(r.AppSettings.apiHome)+"/api/v1/datasource",s).pipe(o.timeout(2e4),o.retry(3)).subscribe((function(r){var o=new Date,i=r.expiresSeconds>0?r.expiresSeconds:99999999,a={expiresWhen:new Date(o.getTime()+1e4*i),rowCount:r.rowCount,jsonData:r.jsonData,results:r.results};t.appAuditService.RecordLog(Object.assign(Object.assign({},c),{result:"Success"})),t.dataSourceStore.update(n,a),t.inflightRequests.delete(n),e.next(a),e.complete()}),(function(r){var o={expiresWhen:new Date,error:r.message};t.appAuditService.RecordLog(Object.assign(Object.assign({},c),{result:r.message})),t.dataSourceStore.update(n,o),t.inflightRequests.delete(n),t.logger.error(r,"DataSource.Service.getDataSource",!1),e.error(r)}))}))),this.inflightRequests.get(n)},e.prototype.getKey=function(e){return"name:"+e.name+" seed:"+e.seed+" inputData:"+JSON.stringify(e.inputData)+" "},e}();x.ɵfac=function(n){return new(n||x)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(e.DataSourceStore),t.ɵɵinject(H),t.ɵɵinject(D),t.ɵɵinject(Q),t.ɵɵinject(V))},x.ɵprov=t.ɵɵdefineInjectable({token:x,factory:x.ɵfac,providedIn:"root"}),e.MenuStore=function(e){function t(){var t=e.call(this)||this;return console.log("MenuStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.MenuStore.ɵfac=function(t){return new(t||e.MenuStore)},e.MenuStore.ɵprov=t.ɵɵdefineInjectable({token:e.MenuStore,factory:e.MenuStore.ɵfac,providedIn:"root"}),e.MenuStore=y([n.StoreConfig({name:"menu",idKey:"name"})],e.MenuStore),e.MenuQuery=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.folders$=n.selectAll({filterBy:[function(e){return"folder"===e.type}]}),n}return S(t,e),t}(n.QueryEntity),e.MenuQuery.ɵfac=function(n){return new(n||e.MenuQuery)(t.ɵɵinject(e.MenuStore))},e.MenuQuery.ɵprov=t.ɵɵdefineInjectable({token:e.MenuQuery,factory:e.MenuQuery.ɵfac,providedIn:"root"}),e.MenuQuery=y([n.QueryConfig({sortBy:"order",sortByOrder:n.Order.ASC})],e.MenuQuery),e.RolesStore=function(e){function t(){var t=e.call(this)||this;return console.log("RoleStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.RolesStore.ɵfac=function(t){return new(t||e.RolesStore)},e.RolesStore.ɵprov=t.ɵɵdefineInjectable({token:e.RolesStore,factory:e.RolesStore.ɵfac,providedIn:"root"}),e.RolesStore=y([n.StoreConfig({name:"role",idKey:"name"})],e.RolesStore);var T=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n}return S(t,e),t}(n.QueryEntity);T.ɵfac=function(n){return new(n||T)(t.ɵɵinject(e.RolesStore))},T.ɵprov=t.ɵɵdefineInjectable({token:T,factory:T.ɵfac,providedIn:"root"});var N=function(){function e(e,t,n,a,s,u){var c=this;this.http=e,this.rolesQuery=t,this.appSettingsQuery=n,this.dataSourceService=a,this.rolesStore=s,this.authQuery=u,this.routeRoles=new Map,this.rolesStore.setLoading(!1),i.combineLatest(this.authQuery.authenticated$,this.appSettingsQuery.selectEntity(r.AppSettings.apiHome)).subscribe((function(e){var t=I(e,2),n=t[0],r=t[1];n&&r?(c.apiHome=r.value,c.rolesQuery.selectLoading().pipe(o.take(1)).subscribe((function(e){e||c.downloadRoles()}))):n||c.rolesStore.remove()}))}return e.prototype.downloadRoles=function(){var e=this;this.rolesStore.setLoading(!0),this.dataSourceService.getDataSource({name:"system.Roles.Select"}).pipe(o.finalize((function(){e.rolesStore.setLoading(!1)}))).subscribe((function(t){t&&!t.error&&(e.rolesStore.add(t.jsonData),e.rolesStore.setLoading(!1))}))},e.prototype.isInRole=function(e){var t=this.authQuery.getValue().userDetails;return!(!t||!t.role)&&t.role.indexOf(e)>-1},e.prototype.isInRoles=function(e){var t=!1,n=this.authQuery.getValue().userDetails;return n&&n.role&&e.forEach((function(e){n.role.indexOf(e)>-1&&(t=!0)})),t},e.prototype.addRouteRoles=function(e,t){this.routeRoles.set(e,t)},e.prototype.getRouteRoles=function(e){return this.routeRoles.get(e)},e}();N.ɵfac=function(n){return new(n||N)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(T),t.ɵɵinject(k),t.ɵɵinject(x),t.ɵɵinject(e.RolesStore),t.ɵɵinject(R))},N.ɵprov=t.ɵɵdefineInjectable({token:N,factory:N.ɵfac,providedIn:"root"});var U=function(){function e(e,t,n,o,a,s,u){var c=this;this.http=e,this.menuStore=t,this.menuQuery=n,this.appSettingsQuery=o,this.authQuery=a,this.log=s,this.rolesService=u,this.methodName="MenuService",this.masterListMenu=[],this.routes=[],this.menuItems=[],this.routeSubject=new i.BehaviorSubject(this.routes),this.httpInFlight=!1,this.lockCount=0,this.menuDownloaded=!1,i.combineLatest([this.authQuery.authenticated$,this.appSettingsQuery.selectEntity(r.AppSettings.apiHome),this.appSettingsQuery.selectEntity(r.AppSettings.isMobile)]).subscribe((function(e){var t=I(e,3),n=t[0],r=t[1],o=t[2];n&&r&&o&&!c.menuDownloaded?(c.apiHome=r.value,c.httpInFlight||c.downloadMenuItems(o.value||!1)):n||(c.menuDownloaded=!1,c.lockCount=0)}))}return e.prototype.addLock=function(){this.lockCount++,this.log.info("MENU Service: Locks on Loading",this.methodName,this.lockCount),this.menuStore.setLoading(!0)},e.prototype.setCurrent=function(e){this.menuStore.setActive(e)},e.prototype.removeLock=function(){this.lockCount--,this.log.info("MENU Service: Locks on Loading",this.methodName,this.lockCount),0===this.lockCount&&this.menuStore.setLoading(!1)},e.prototype.addMenuItemsFromCode=function(e,t){var n=this;void 0===t&&(t=null),this.addLock(),this.log.info("Adding MenuItems menuItems",this.methodName,e),this.authQuery.authenticated$.subscribe((function(t){t&&(n.addMenuItems(e),n.removeLock())}))},e.prototype.getFolders=function(){return this.menuQuery.getAll({filterBy:[function(e){return"folder"===e.type}]})},e.prototype.delete=function(e){var t=this;return new i.Observable((function(n){t.http.delete(t.apiHome+"/api/v1/menuitems/"+e.name).subscribe((function(){t.menuStore.remove(e.name);var r,o=JSON.parse(JSON.stringify(t.menuQuery.getValue())).menuItems;e.parent&&(r=o.find((function(t){return t.name&&t.name.toLowerCase()===e.parent.toLowerCase()})));var i=r.items.findIndex((function(t){return t.name&&t.name===e.name}));r.items.splice(i,1),t.menuStore.update({menuItems:o}),n.next(),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.saveMenuItem=function(e){return this.http.post(this.apiHome+"/api/v1/menuitems",e)},e.prototype.updateExistingMenuItem=function(e){var t=this.menuQuery.hasEntity(e.name);t?this.menuStore.upsert(e.name,e):this.menuStore.add(e);var n,r=JSON.parse(JSON.stringify(this.menuQuery.getAll()));if(e.parent&&(n=r.find((function(t){return t.name.toLowerCase()===e.parent.toLowerCase()}))),n.items&&Array.isArray(n.items)||(n.items=[]),t){var o=n.items.findIndex((function(t){return t.name===e.name}));n.items[o]=e}else n.items.push(e);this.menuStore.update({menuItems:r})},e.prototype.addMenuItemsToReferenceList=function(e){var t=this;e.forEach((function(e){t.menuStore.upsert(e.name,e),e.items&&Array.isArray(e.items)&&t.addMenuItemsToReferenceList(e.items)}))},e.prototype.removeUnauthorisedMenuItems=function(e){var t=this.authQuery.getValue(),n=[];t&&t.userDetails&&(n=t.userDetails.role);for(var r=[],o=JSON.parse(JSON.stringify(e)),i=0;i<o.length;i++){var a=o[i],s=!1,u=[];(u=a.roles?Array.isArray(a.roles)?j(a.roles):[a.roles]:[])&&u.length>0&&n&&0===u.filter((function(e){return-1!==n.indexOf(e)})).length&&(s=!0,r.push(a.name)),!s&&a.items&&(a.items=this.removeUnauthorisedMenuItems(a.items))}return r.length>0&&(o=e.filter((function(e){return-1===r.findIndex((function(t){return t===e.name}))}))),o},e.prototype.downloadMenuItems=function(e){var t=this;this.addLock(),this.httpInFlight=!0;this.http.get(this.apiHome+"/api/v1/menuitems?mobile="+e).pipe(o.timeout(6e4),o.finalize((function(){t.httpInFlight=!1,t.removeLock()}))).subscribe((function(e){t.log.info("Downloaded MenuItems"),t.menuDownloaded=!0,t.addMenuItems(e)}),(function(e){t.log.error("Failed to download Menu")}))},e.prototype.addMenuItems=function(e,t){var n=this;void 0===t&&(t=!1);var r=this.menuQuery.getValue().menuItems||[];this.menuItems=JSON.parse(JSON.stringify(r)),this.calculateRouterLinks(e),this.addMenuItemsToReferenceList(e),t?e.forEach((function(e){n.upsertMenuItemToExistingTree(e)})):e.forEach((function(e){n.addNewMenuItemToEntities(n.menuItems,e)})),this.menuItems=this.removeUnauthorisedMenuItems(this.menuItems),this.menuStore.update({menuItems:this.menuItems})},e.prototype.calculateRouterLinks=function(e){var t=this;e&&e.forEach((function(e){if(!e.routerLink)switch(e.type){case"dashboard":e.routerLink="dashboard/"+e.name;break;case"datagrid":e.routerLink="datagrid/"+e.name;break;case"folder":break;default:e.routerLink=e.name}e.items&&t.calculateRouterLinks(e.items)}))},e.prototype.addRoute=function(e,t){void 0===t&&(t=null),this.log.info("Adding Route "+JSON.stringify(e)),this.routes.push(e),null!==t&&this.rolesService.addRouteRoles(e.path,t)},e.prototype.upsertMenuItemToExistingTree=function(e){var t=j(this.menuItems);if(e.parent&&""!==e.parent){var n=t.find((function(t){return t.name===e.parent}));if(n)n.items.find((function(t){return t.name===e.name}))?Object.assign({},e):n.items.push(Object.assign({},e))}else{t.find((function(t){return t.name===e.name}))?Object.assign({},e):t.push(Object.assign({},e))}this.menuItems=t},e.prototype.addNewMenuItemToEntities=function(e,t){var n,r=this;if(e&&!e.find((function(e){return e.name===t.name}))){n=t.routerLink&&t.routerLink.indexOf(",")>-1?t.routerLink.split(","):t.routerLink;var o=Object.assign(Object.assign({},t),{routerLink:n});if(e.push(o),t.items&&t.items.length>0)o.items=[],t.items.forEach((function(e){r.addNewMenuItemToEntities(o.items,e)}))}},e}();U.ɵfac=function(n){return new(n||U)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(e.MenuStore),t.ɵɵinject(e.MenuQuery),t.ɵɵinject(k),t.ɵɵinject(R),t.ɵɵinject(V),t.ɵɵinject(N))},U.ɵprov=t.ɵɵdefineInjectable({token:U,factory:U.ɵfac,providedIn:"root"}),e.ReferenceValuesStore=function(e){function t(){var t=e.call(this,{isInitialised:!1})||this;return console.log("ReferenceValuesStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.ReferenceValuesStore.ɵfac=function(t){return new(t||e.ReferenceValuesStore)},e.ReferenceValuesStore.ɵprov=t.ɵɵdefineInjectable({token:e.ReferenceValuesStore,factory:e.ReferenceValuesStore.ɵfac,providedIn:"root"}),e.ReferenceValuesStore=y([n.StoreConfig({name:"referenceValues",idKey:"compositeKey"})],e.ReferenceValuesStore);var F=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.isInitialised$=n.select((function(e){return e.isInitialised})),n}return S(t,e),t}(n.QueryEntity);F.ɵfac=function(n){return new(n||F)(t.ɵɵinject(e.ReferenceValuesStore))},F.ɵprov=t.ɵɵdefineInjectable({token:F,factory:F.ɵfac,providedIn:"root"});var K=function(){function e(e,t,n,r,o){this.http=e,this.appSettingsService=t,this.refValuesQuery=n,this.refValuesStore=r,this.logger=o,this.className="ReferenceValuesService",this.requestsInFlight=new Map}return e.prototype.getValue=function(e,t){var n=this;return new i.Observable((function(r){n.getReferenceValue(e,t).subscribe((function(e){e?r.next(e.value):r.next(null),r.complete()}))}))},e.prototype.clearReferenceValue=function(e){var t,n,r;r=Array.isArray(e)?e:[e];var o=function(e){var t,n,r=i.refValuesQuery.getAll({filterBy:function(t){return t.name.startsWith(e)}});try{for(var o=(t=void 0,w(r)),a=o.next();!a.done;a=o.next()){var s=a.value;i.refValuesStore.remove(s.compositeKey)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},i=this;try{for(var a=w(r),s=a.next();!s.done;s=a.next()){o(s.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.setReferenceValue=function(e){e.compositeKey=this.getKey(e.name,""),this.refValuesStore.upsert(this.getKey(e.name,""),e)},e.prototype.isExpired=function(e){var t=e.cacheSeconds||31556952,n=new Date,r=new Date(e.whenStored);return r.setSeconds(r.getSeconds()+t),n>r},e.prototype.getReferenceValue=function(e,t,n){var r=this;if(void 0===t&&(t=""),void 0===n&&(n=0),this.refValuesQuery.hasEntity(this.getKey(e,t))){var o=this.refValuesQuery.getEntity(this.getKey(e,t));return this.isExpired(o)?this.downloadRefValue(e,t):(this.logger.info("Reference Values From Cache "+e+"::"+t),new i.Observable((function(n){n.next(r.refValuesQuery.getEntity(r.getKey(e,t))),n.complete()})))}if(!(n>0))return this.downloadRefValue(e,t);var a=this.refValuesQuery.getEntity(this.getKey(e,""));if(a){var s=a.referenceValueItems.find((function(e){return e.value===t}));if(s){var u=Object.assign({},a);return u.referenceValueItems=s.referenceValueItems,new i.Observable((function(e){e.next(u),e.complete()}))}}},e.prototype.downloadRefValue=function(e,t){var n=this;if(this.requestsInFlight.has(this.getKey(e,t)))return this.requestsInFlight.get(this.getKey(e,t));var a=new i.Observable((function(i){n.logger.info("Reference Values From HTTP "+e+"::"+t),n.http.get(n.appSettingsService.getValue(r.AppSettings.apiHome)+"/api/v1/referencevalues?name="+e+"&seed="+t).pipe(o.timeout(2e4),o.retry(3)).subscribe((function(r){r.compositeKey=n.getKey(e,t),r.whenStored=new Date,n.refValuesStore.upsert(n.getKey(e,t),r),n.requestsInFlight.delete(n.getKey(e,t)),i.next(r),i.complete()}),(function(r){n.refValuesQuery.hasEntity(n.getKey(e,t))?(n.logger.info("Reference Values From HTTP Failed using last Cache "+e+"::"+t),i.next(n.refValuesQuery.getEntity(n.getKey(e,t))),i.complete()):i.error(r)}))}));return this.requestsInFlight.set(this.getKey(e,t),a),a},e.prototype.getKey=function(e,t){return e+"::"+t},e}();K.ɵfac=function(n){return new(n||K)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(D),t.ɵɵinject(F),t.ɵɵinject(e.ReferenceValuesStore),t.ɵɵinject(V))},K.ɵprov=t.ɵɵdefineInjectable({token:K,factory:K.ɵfac,providedIn:"root"});var _=function(){function e(e){this.broadcastService=e}return e.prototype.showSpinner=function(e){void 0===e&&(e=null),this.broadcastService.broadcast("SHOW_SPINNER",e)},e.prototype.hideSpinner=function(){this.broadcastService.broadcast("HIDE_SPINNER")},e}();_.ɵfac=function(e){return new(e||_)(t.ɵɵinject(A))},_.ɵprov=t.ɵɵdefineInjectable({token:_,factory:_.ɵfac,providedIn:"root"});var W=function(){};W.ɵfac=function(e){return new(e||W)},W.ɵprov=t.ɵɵdefineInjectable({token:W,factory:W.ɵfac});var q=function(){function e(e,t,n,r,o,i){this.logger=e,this.http=t,this.authStore=n,this.authQuery=r,this.appSettingsService=o,this.router=i,this.tokenStorageKey="USER_TOKEN",e.info("UserAuthorisationService - Constructor"),this.jwtHelper=new u.JwtHelperService({}),this.loadUserTokenFromStorage()}return e.prototype.filterItemsByRole=function(e){var t=this,n=[];return e&&e.forEach((function(e){t.checkByRoles(e)&&n.push(e)})),n},e.prototype.checkByRoles=function(e){if(!e.roles)return!0;var t=!1,n=this.authQuery.getUser();return n.role&&n.role.forEach((function(n){e.roles.forEach((function(e){n===e&&(t=!0)}))})),t},e.prototype.completeAuthentication=function(){},e.prototype.isAuthenticated=function(){var e=this.getToken();return this.jwtHelper.decodeToken(e)&&!this.jwtHelper.isTokenExpired(e)},e.prototype.authorizationHeaderValue=function(){},e.prototype.name=function(){return"Hello World"},e.prototype.forceLogon=function(e){this.logoff(),this.router.navigate(["login"],{queryParams:{returnUrl:e}})},e.prototype.getToken=function(){return this.authQuery.getValue().token},e.prototype.loadUserTokenFromStorage=function(){var e=localStorage.getItem(this.tokenStorageKey);null!==e?this.jwtHelper.isTokenExpired(e)?this.logger.info("Token from Storage - Token Expired - Not using"):(this.logger.info("Token from Storage - Token Loaded and not Expired"),this.setToken(e)):this.logger.info("Token from Storage - No Token Available")},e.prototype.setToken=function(e){var t=this.jwtHelper.decodeToken(e),n=new r.BasicUser;t.firstName&&t.lastName&&(n.name=t.firstName+" "+t.lastName),t.sub&&(n.userId=t.sub),t.role&&(n.role=t.role),t.email&&(n.email=t.email),this.authStore.update({token:e,userDetails:n,authenticated:!0})},e.prototype.logon=function(e,t){var n=this;return new i.Observable((function(i){var s=new a.HttpParams;s=s.append("username",e).append("password",t).append("grant_type","password").append("client_id",n.appSettingsService.getValue(r.AppSettings.authClientId)).append("client_secret",n.appSettingsService.getValue(r.AppSettings.authClientSecret)).append("scope",n.appSettingsService.getValue(r.AppSettings.authScope)+" offline_access openid"),n.http.post(n.appSettingsService.getValue(r.AppSettings.apiAuth)+n.appSettingsService.getValue(r.AppSettings.authTokenEndpoint),s,{headers:(new a.HttpHeaders).set("Content-Type","application/x-www-form-urlencoded")}).pipe(o.timeout(3e4)).subscribe((function(e){var t=n.jwtHelper.decodeToken(e.access_token),o=n.appSettingsService.getValue(r.AppSettings.authRequiredRole);t.role&&(o&&!t.role.includes(o)?i.error("Unauthorised"):(n.appSettingsService.getValue(r.AppSettings.authSaveinLocalStorage)&&localStorage.setItem(n.tokenStorageKey,e.access_token),n.setToken(e.access_token),e.refresh_token,i.next(null),i.complete()))}),(function(e){i.error(e)}))}))},e.prototype.logoff=function(){this.appSettingsService.getValue(r.AppSettings.authSaveinLocalStorage)&&localStorage.removeItem(this.tokenStorageKey),n.resetStores({exclude:["appSettings"]}),this.authStore.update({token:null,userDetails:null,authenticated:!1})},e}();q.ɵfac=function(n){return new(n||q)(t.ɵɵinject(V),t.ɵɵinject(a.HttpClient),t.ɵɵinject(e.AuthenticationStore),t.ɵɵinject(R),t.ɵɵinject(D),t.ɵɵinject(c.Router))},q.ɵprov=t.ɵɵdefineInjectable({token:q,factory:q.ɵfac,providedIn:"root"});var B=function(){function e(e,t,n){var o=this;this.authStore=e,this.authQuery=t,this.appSettingsQuery=n,this.jwtHelper=new u.JwtHelperService({}),n.selectEntity(r.AppSettings.authOAuthSettings).subscribe((function(e){o.manager=new p.UserManager(e.value),o.manager.getUser().then((function(e){e&&(o.user=e,o.setToken(o.user.access_token))}))}))}return e.prototype.filterItemsByRole=function(e){var t=this,n=[];return e&&e.forEach((function(e){t.checkByRoles(e)&&n.push(e)})),n},e.prototype.checkByRoles=function(e){if(!e.roles)return!0;var t=!1,n=this.authQuery.getUser();return n.role&&n.role.forEach((function(n){e.roles.forEach((function(e){n===e&&(t=!0)}))})),t},e.prototype.getToken=function(){return this.user.access_token},e.prototype.forceLogon=function(){this.logon()},e.prototype.logon=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),this.manager.signinRedirect()},e.prototype.logoff=function(){return m(this,void 0,void 0,(function(){return b(this,(function(e){switch(e.label){case 0:return[4,this.manager.signoutRedirect()];case 1:return e.sent(),[2]}}))}))},e.prototype.completeAuthentication=function(){return m(this,void 0,void 0,(function(){var e;return b(this,(function(t){switch(t.label){case 0:return e=this,[4,this.manager.signinRedirectCallback()];case 1:return e.user=t.sent(),this.setToken(this.user.access_token),[2]}}))}))},e.prototype.isAuthenticated=function(){var e=this;return this.manager.getUser().then((function(t){e.user=t})),null!=this.user&&!this.user.expired},e.prototype.authorizationHeaderValue=function(){return this.user.token_type+" "+this.user.access_token},e.prototype.name=function(){return null!=this.user?this.user.profile.name:""},e.prototype.setToken=function(e){var t=this.jwtHelper.decodeToken(e),n=new r.BasicUser;t.name?n.name=t.name:t.firstName&&t.lastName&&(n.name=t.firstName+" "+t.lastName),t.role&&(n.role=t.role),t.email&&(n.userId=t.email,n.email=t.email),this.authStore.update({token:e,userDetails:n,authenticated:!0})},e}();B.ɵfac=function(n){return new(n||B)(t.ɵɵinject(e.AuthenticationStore),t.ɵɵinject(R),t.ɵɵinject(k))},B.ɵprov=t.ɵɵdefineInjectable({token:B,factory:B.ɵfac,providedIn:"root"}),e.UserPreferencesStore=function(e){function t(){var t=e.call(this,{isInitialised:!1})||this;return console.log("UserPreferencesStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.UserPreferencesStore.ɵfac=function(t){return new(t||e.UserPreferencesStore)},e.UserPreferencesStore.ɵprov=t.ɵɵdefineInjectable({token:e.UserPreferencesStore,factory:e.UserPreferencesStore.ɵfac,providedIn:"root"}),e.UserPreferencesStore=y([n.StoreConfig({name:"userPreferences",idKey:"name"})],e.UserPreferencesStore);var J=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n.isInitialised$=n.select((function(e){return e.isInitialised})),n}return S(t,e),t}(n.QueryEntity);J.ɵfac=function(n){return new(n||J)(t.ɵɵinject(e.UserPreferencesStore))},J.ɵprov=t.ɵɵdefineInjectable({token:J,factory:J.ɵfac,providedIn:"root"});var z=function(){function e(e,t,n,o,a,s,u){var c=this;this.http=e,this.authQuery=t,this.appSettingsQuery=n,this.logger=o,this.userPrefsStore=a,this.userPrefsQuery=s,this.appSettings=u,this.className="UserPreferencesService",this.prefix="preference_",this.storageKey="UserPreferences",this.valuesDownloaded=!1,this.definitionsDownloaded=!1,this.httpInFlight=0,i.combineLatest([this.authQuery.authenticated$,this.appSettingsQuery.selectEntity(r.AppSettings.apiHome)]).subscribe((function(e){var t=I(e,2),n=t[0],r=t[1];n&&r&&!c.valuesDownloaded&&!c.definitionsDownloaded?(c.apiHome=r.value,c.httpInFlight||(c.loadFromLocal(),c.getDefinitions(),c.getValues())):n||c.clearValues()}))}return e.prototype.clearValues=function(){this.userPrefsStore.remove(),localStorage.removeItem(this.storageKey)},e.prototype.deleteValue=function(e){var t=this;return new i.Observable((function(n){t.http.delete(t.appSettings.getValue(r.AppSettings.apiHome)+"/api/v1/userpreferencevalue/"+e).subscribe((function(){t.userPrefsStore.remove(e),localStorage.removeItem(t.storageKey),t.saveToLocal(),n.next(),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.getValues=function(){var e=this;this.httpInFlight++,this.http.get(this.appSettings.getValue(r.AppSettings.apiHome)+"/api/v1/userpreferencevalue").subscribe((function(t){t&&(t.forEach((function(t){e.userPrefsStore.upsert(t.name,t)})),e.userPrefsStore.setLoading(!1),e.httpInFlight--,e.valuesDownloaded=!0)}),(function(t){e.httpInFlight--,e.logger.error(t,e.className,!0)}))},e.prototype.setValue=function(e,t){var n=this;return new i.Observable((function(o){n.http.post(n.appSettings.getValue(r.AppSettings.apiHome)+"/api/v1/userpreferencevalue",{name:e,value:t}).subscribe((function(){var i=n.userPrefsQuery.getEntity(e),a=new r.UserPreferenceValue;i?a=JSON.parse(JSON.stringify(i)):(a.name=e,a.userId=n.authQuery.getValue().userDetails.userId),a.value=t,n.userPrefsStore.upsert(e,a),o.next(),o.complete()}),(function(e){o.error(e)}))}))},e.prototype.getDefinitions=function(){var e=this;this.httpInFlight++,this.http.get(this.appSettings.getValue(r.AppSettings.apiHome)+"/api/v1/UserPreferenceDefinition").subscribe((function(t){if(t&&t.length>0){var n=[];t.forEach((function(e){n.push(e)})),e.httpInFlight--,e.definitionsDownloaded=!0,e.userPrefsStore.update({preferenceDefinitions:n})}}),(function(t){e.httpInFlight--}))},e.prototype.loadFromLocal=function(){var e=localStorage.getItem(this.storageKey);if(e){var t=JSON.parse(e);t&&t.length>0&&t.forEach((function(e){}))}},e.prototype.saveToLocal=function(){var e=JSON.stringify(this.userPrefsQuery.getValue().entities);localStorage.setItem(this.storageKey,e)},e}();z.ɵfac=function(n){return new(n||z)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(R),t.ɵɵinject(k),t.ɵɵinject(V),t.ɵɵinject(e.UserPreferencesStore),t.ɵɵinject(J),t.ɵɵinject(D))},z.ɵprov=t.ɵɵdefineInjectable({token:z,factory:z.ɵfac,providedIn:"root"}),e.WidgetStore=function(e){function t(){var t=e.call(this)||this;return console.log("WidgetStore Constructor"),t}return S(t,e),t}(n.EntityStore),e.WidgetStore.ɵfac=function(t){return new(t||e.WidgetStore)},e.WidgetStore.ɵprov=t.ɵɵdefineInjectable({token:e.WidgetStore,factory:e.WidgetStore.ɵfac,providedIn:"root"}),e.WidgetStore=y([n.StoreConfig({name:"widget",idKey:"name"})],e.WidgetStore);var $=function(e){function t(t){var n=e.call(this,t)||this;return n.store=t,n}return S(t,e),t}(n.QueryEntity);$.ɵfac=function(n){return new(n||$)(t.ɵɵinject(e.WidgetStore))},$.ɵprov=t.ɵɵdefineInjectable({token:$,factory:$.ɵfac,providedIn:"root"});var G=function(){function e(e,t,n,a,s,u,c){var p=this;this.http=e,this.widgetStore=t,this.widgetQuery=n,this.appSettingsQuery=a,this.authQuery=s,this.log=u,this.rolesService=c,this.className="core.WidgetService",this.widgetStore.setLoading(!1),i.combineLatest(this.authQuery.authenticated$,this.appSettingsQuery.selectEntity(r.AppSettings.apiHome)).subscribe((function(e){var t=I(e,2),n=t[0],r=t[1];n&&r?(p.apiHome=r.value,p.widgetQuery.selectLoading().pipe(o.take(1)).subscribe((function(e){e||p.downloadWidgetItems()}))):n||p.widgetStore.remove()}))}return e.prototype.downloadWidgetItems=function(){var e=this;this.widgetStore.setLoading(!0),this.http.get(this.apiHome+"/api/v1/widgets").pipe(o.finalize((function(){e.widgetStore.setLoading(!1)}))).subscribe((function(t){e.widgetStore.add(t)}))},e}();G.ɵfac=function(n){return new(n||G)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(e.WidgetStore),t.ɵɵinject($),t.ɵɵinject(k),t.ɵɵinject(R),t.ɵɵinject(V),t.ɵɵinject(N))},G.ɵprov=t.ɵɵdefineInjectable({token:G,factory:G.ɵfac,providedIn:"root"});var Z=function(){function e(e,t,n,r,o){this.http=e,this.appSettingsService=t,this.authQuery=n,this.log=r,this.rolesService=o,this.className="core.UserService"}return e.prototype.getUsers=function(){var e=this;return new i.Observable((function(t){e.http.get(e.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users")})).pipe(o.timeout(3e4))},e.prototype.createUser=function(e){var t=this;return new i.Observable((function(n){t.http.post(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users",e)})).pipe(o.timeout(3e4))},e.prototype.deleteUser=function(e){var t=this;return new i.Observable((function(n){t.http.delete(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users/"+e)})).pipe(o.timeout(3e4))},e.prototype.changePassword=function(e){var t=this;return new i.Observable((function(n){t.http.post(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users/changePassword",e).pipe(o.timeout(3e4)).subscribe((function(e){n.next(null),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.setPassword=function(e){var t=this;return new i.Observable((function(n){t.http.post(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users/setPassword",e).pipe(o.timeout(3e4)).subscribe((function(e){n.next(null),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.resetPassword=function(e){var t=this;return new i.Observable((function(n){t.http.get(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users/resetPassword/"+e)})).pipe(o.timeout(3e4))},e.prototype.getUser=function(e){var t=this;return new i.Observable((function(n){t.http.get(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users/"+e)})).pipe(o.timeout(3e4))},e.prototype.saveUser=function(e){var t=this;return new i.Observable((function(n){t.http.post(t.appSettingsService.getValue(r.AppSettings.apiAuth)+"/api/v1/users/",e)})).pipe(o.timeout(3e4))},e}();Z.ɵfac=function(e){return new(e||Z)(t.ɵɵinject(a.HttpClient),t.ɵɵinject(D),t.ɵɵinject(R),t.ɵɵinject(V),t.ɵɵinject(N))},Z.ɵprov=t.ɵɵdefineInjectable({token:Z,factory:Z.ɵfac,providedIn:"root"});var X=function(){},Y=function(){},ee=function(){function e(e){this.logging=e,this.versions=[]}return e.prototype.addVersion=function(e,t,n){void 0===n&&(n=!1),this.logging.info("Loading Module "+e+" Version "+t+" IsAppModule "+n),this.versions.push({module:e,version:t,isAppModule:n})},e.prototype.getVersions=function(){return this.versions},e.prototype.getVersion=function(e){var t=this.versions.find((function(t){return t.module===e}));return t?t.version:null},e}();ee.ɵfac=function(e){return new(e||ee)(t.ɵɵinject(V))},ee.ɵprov=t.ɵɵdefineInjectable({token:ee,factory:ee.ɵfac,providedIn:"root"});var te=function(){function e(e,t){this.el=e,this.logger=t,this.footerElement=null,this.fixedHeight=0,this.relativeToParentPercent=0}return e.prototype.ngAfterViewInit=function(){this.calculateAndSetElementHeight()},e.prototype.onResize=function(e){this.calculateAndSetElementHeight()},e.prototype.calculateAndSetElementHeight=function(){if(this.relativeToParentPercent>0){var e=this.el.nativeElement.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.offsetHeight;e>0&&(this.el.nativeElement.style.height=e*(this.relativeToParentPercent/100)+"px")}else if(this.fixedHeight>0)this.el.nativeElement.style.height=this.fixedHeight+"px";else{this.el.nativeElement.style.overflow="auto";var t=window.innerHeight;0===t&&(this.logger.error("FillHeight: Window reported zero height"),t=800);var n=this.getElementOffsetTop(),r=(this.el.nativeElement.style.marginBottom,this.getfooterElementMargin());this.el.nativeElement.style.height=t-r-n-16+"px"}},e.prototype.getElementOffsetTop=function(){return this.el.nativeElement.getBoundingClientRect().top},e.prototype.getfooterElementMargin=function(){if(!this.footerElement)return 0;var e=window.getComputedStyle(this.footerElement);return parseInt(e.height,10)},e}();te.ɵfac=function(e){return new(e||te)(t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(V))},te.ɵdir=t.ɵɵdefineDirective({type:te,selectors:[["","ngsFillHeight",""]],hostBindings:function(e,n){1&e&&t.ɵɵlistener("resize",(function(e){return n.onResize(e)}),!1,t.ɵɵresolveWindow)},inputs:{footerElement:"footerElement",fixedHeight:"fixedHeight",relativeToParentPercent:"relativeToParentPercent"}});var ne=function(){function e(){}return e.prototype.transform=function(e){var t;switch(e){case"primary":t="p-button-primary";break;case"secondary":t="p-button-secondary";break;case"success":t="p-button-success";break;case"info":t="p-button-info";break;case"warning":t="p-button-warning";break;case"danger":t="p-button-danger";break;case"blue":t="blue-grey-btn";break;case"cyan":t="cyan-btn";break;case"teal":t="teal-btn";break;case"orange":t="orange-btn";break;case"deeporange":t="deep-orange-btn";break;case"purple":t="purple-btn";break;case"indigo":t="indigo-btn";break;case"pink":t="pink-btn";break;default:t="p-button-info"}return t},e}();ne.ɵfac=function(e){return new(e||ne)},ne.ɵpipe=t.ɵɵdefinePipe({name:"buttonColour",type:ne,pure:!0});var re=g,oe=function(){function e(e){this.appSettings=e}return e.prototype.transform=function(e){if(e){("string"==typeof e||e instanceof String)&&(e=new Date(e));var t=6e4*e.getTimezoneOffset(),n=new Date(e.getTime()+t),o=this.appSettings.getEntity(r.AppSettings.dateFormat);return o&&o.value?re(n,o.value):re(n,"default")}return""},e}();oe.ɵfac=function(e){return new(e||oe)(t.ɵɵdirectiveInject(k))},oe.ɵpipe=t.ɵɵdefinePipe({name:"ngsDate",type:oe,pure:!0});var ie=g,ae=function(){function e(e){this.appSettings=e}return e.prototype.transform=function(e){if(e){("string"==typeof e||e instanceof String)&&(e=new Date(e));var t=6e4*e.getTimezoneOffset(),n=new Date(e.getTime()+t),o=this.appSettings.getEntity(r.AppSettings.dateTimeFormat);return o&&o.value?ie(n,o.value):ie(n,"default")}return""},e}();ae.ɵfac=function(e){return new(e||ae)(t.ɵɵdirectiveInject(k))},ae.ɵpipe=t.ɵɵdefinePipe({name:"ngsDateTime",type:ae,pure:!0});var se=function(){function e(){}return e.prototype.transform=function(e,t,n){void 0===t&&(t=40),void 0===n&&(n="…");var r=e||"";if(e){var o=e.split(/\s+/);o.length>Math.abs(t)&&(t<0?(t*=-1,r=n+o.slice(o.length-t,o.length).join(" ")):r=o.slice(0,t).join(" ")+n)}return r},e}();se.ɵfac=function(e){return new(e||se)},se.ɵpipe=t.ɵɵdefinePipe({name:"truncateText",type:se,pure:!0});var ue=function(){function e(e,t,n){this.authService=e,this.router=t,this.rolesService=n}return e.prototype.canActivate=function(e,t){return!!this.authService.isAuthenticated()||(this.authService.forceLogon(t.url),!1)},e}();ue.ɵfac=function(e){return new(e||ue)(t.ɵɵinject(W),t.ɵɵinject(c.Router),t.ɵɵinject(N))},ue.ɵprov=t.ɵɵdefineInjectable({token:ue,factory:ue.ɵfac});var ce=function(){function e(){this.closed=new t.EventEmitter}return e.prototype.ngOnChanges=function(e){},e.prototype.ngOnDestroy=function(){},e.prototype.ngOnInit=function(){},e.prototype.cancel=function(e){this.closed.emit(null)},e.prototype.save=function(e){},e}();ce.ɵfac=function(e){return new(e||ce)},ce.ɵcmp=t.ɵɵdefineComponent({type:ce,selectors:[["ngs-dialog-window"]],outputs:{closed:"closed"},features:[t.ɵɵNgOnChangesFeature],decls:2,vars:0,template:function(e,n){1&e&&(t.ɵɵelementStart(0,"h1"),t.ɵɵtext(1,"Dialog Window Base Class"),t.ɵɵelementEnd())},styles:[""]});var pe="1.1.20",le=function(){function e(e){e.addVersion("@ngscaffolding/core",pe)}return e.forRoot=function(){return{ngModule:e}},e}();le.ɵmod=t.ɵɵdefineNgModule({type:le}),le.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||le)(t.ɵɵinject(ee))},imports:[[f.CommonModule,h.FormsModule,a.HttpClientModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(le,{declarations:[te,ne,oe,ae,se,ce],imports:[f.CommonModule,h.FormsModule,a.HttpClientModule],exports:[ne,oe,ae,se,te,ce]}),e.AppAuditService=Q,e.AppSettingsQuery=k,e.AppSettingsService=D,e.AuditLogService=O,e.AuthoriseRoleGuard=ue,e.BroadcastService=A,e.ButtonColourPipe=ne,e.ComponentLoaderService=C,e.CoreErrorHandlerService=P,e.CoreModule=le,e.DataSourceQuery=H,e.DataSourceService=x,e.DialogWindowComponent=ce,e.FillHeightDirective=te,e.LoggingService=V,e.MenuService=U,e.NgsDatePipe=oe,e.NgsDateTimePipe=ae,e.NotificationService=E,e.OAuthService=B,e.ReferenceValuesQuery=F,e.ReferenceValuesService=K,e.RolesQuery=T,e.RolesService=N,e.SoftwareVersion=Y,e.SpinnerService=_,e.TruncateTextPipe=se,e.UserAuthenticationBase=W,e.UserAuthenticationQuery=R,e.UserAuthenticationService=q,e.UserPreferencesQuery=J,e.UserPreferencesService=z,e.UserService=Z,e.UserServiceBase=X,e.VersionsService=ee,e.WidgetQuery=$,e.WidgetService=G,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngscaffolding-core.umd.min.js.map