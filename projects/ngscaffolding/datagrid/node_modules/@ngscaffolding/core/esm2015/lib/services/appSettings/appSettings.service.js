import { Injectable } from '@angular/core';
import { AppSettings } from '@ngscaffolding/models';
import { timeout, retry } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./appSettings.store";
import * as i2 from "./appSettings.query";
import * as i3 from "../logging/logging.service";
import * as i4 from "@angular/common/http";
export class AppSettingsService {
    constructor(appSettingsStore, appSettingsQuery, logger, http) {
        this.appSettingsStore = appSettingsStore;
        this.appSettingsQuery = appSettingsQuery;
        this.logger = logger;
        this.http = http;
        this.className = 'AppSettingsService';
        console.log('AppSettingsService Constructor');
    }
    setValue(name, value) {
        if (this.appSettingsQuery.hasEntity(name)) {
            this.appSettingsStore.update(name, { name: name, value: value });
        }
        else {
            this.appSettingsStore.add({ name: name, value: value });
        }
        if (name === AppSettings.apiHome) {
            this.loadFromServer(value.toString());
        }
    }
    getValue(name) {
        if (this.appSettingsQuery.hasEntity(name)) {
            return this.appSettingsQuery.getEntity(name).value;
        }
        else {
            return null;
        }
    }
    loadFromServer(apiHome) {
        // Mark store as loading
        this.appSettingsStore.setLoading(true);
        // Load values from Server
        this.http
            .get(`${apiHome}/api/v1/appSettings`)
            .pipe(timeout(20000), retry(3))
            .subscribe(appValues => {
            if (appValues) {
                appValues.forEach(appValue => {
                    this.setValue(appValue.name, appValue.value);
                });
            }
            this.appSettingsStore.setLoading(false);
            this.appSettingsStore.update({ isInitialised: true });
        }, err => {
            this.appSettingsStore.setLoading(false);
        });
    }
    setValues(settings) {
        // Mark store as loading
        this.appSettingsStore.setLoading(true);
        this.appSettingsStore.update({ isInitialised: false });
        // Load values
        if (settings) {
            Object.keys(settings).forEach(key => {
                // Setting Value Here
                this.logger.info(`[${this.className}.loadSettings] Setting Value ${key} = ${settings[key]}`);
                this.setValue(key, settings[key]);
            });
        }
        this.appSettingsStore.setLoading(false);
        this.appSettingsStore.update({ isInitialised: true });
    }
    getBoolean(name) {
        return this.appSettingsQuery.selectEntity(name, entity => entity.value);
    }
    getString(name) {
        return this.appSettingsQuery.selectEntity(name, entity => entity.value);
    }
}
AppSettingsService.ɵfac = function AppSettingsService_Factory(t) { return new (t || AppSettingsService)(i0.ɵɵinject(i1.AppSettingsStore), i0.ɵɵinject(i2.AppSettingsQuery), i0.ɵɵinject(i3.LoggingService), i0.ɵɵinject(i4.HttpClient)); };
AppSettingsService.ɵprov = i0.ɵɵdefineInjectable({ token: AppSettingsService, factory: AppSettingsService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AppSettingsService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.AppSettingsStore }, { type: i2.AppSettingsQuery }, { type: i3.LoggingService }, { type: i4.HttpClient }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwU2V0dGluZ3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3NjYWZmb2xkaW5nL2NvcmUvc3JjLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2FwcFNldHRpbmdzL2FwcFNldHRpbmdzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBUSxNQUFNLGVBQWUsQ0FBQztBQUNqRCxPQUFPLEVBQUUsV0FBVyxFQUFvQixNQUFNLHVCQUF1QixDQUFDO0FBTXRFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7OztBQUtoRCxNQUFNLE9BQU8sa0JBQWtCO0lBSzdCLFlBQ1UsZ0JBQWtDLEVBQ2xDLGdCQUFrQyxFQUNsQyxNQUFzQixFQUN0QixJQUFnQjtRQUhoQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDdEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQVJsQixjQUFTLEdBQUcsb0JBQW9CLENBQUM7UUFVdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFTSxRQUFRLENBQUMsSUFBWSxFQUFFLEtBQVU7UUFDdEMsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3pDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNsRTthQUFNO1lBQ0wsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENB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TSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzFFLENBQUM7O29GQWxGVSxrQkFBa0I7MERBQWxCLGtCQUFrQixXQUFsQixrQkFBa0IsbUJBRmpCLE1BQU07a0RBRVAsa0JBQWtCO2NBSDlCLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIFR5cGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQXBwU2V0dGluZ3MsIEFwcFNldHRpbmdzVmFsdWUgfSBmcm9tICdAbmdzY2FmZm9sZGluZy9tb2RlbHMnO1xyXG5pbXBvcnQgeyBMb2dnaW5nU2VydmljZSB9IGZyb20gJy4uL2xvZ2dpbmcvbG9nZ2luZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgQXBwU2V0dGluZ3NTdG9yZSB9IGZyb20gJy4vYXBwU2V0dGluZ3Muc3RvcmUnO1xyXG5pbXBvcnQgeyBBcHBTZXR0aW5nc1F1ZXJ5IH0gZnJvbSAnLi9hcHBTZXR0aW5ncy5xdWVyeSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGltZW91dCwgcmV0cnkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBcHBTZXR0aW5nc1NlcnZpY2Uge1xyXG4gIHByaXZhdGUgY2xhc3NOYW1lID0gJ0FwcFNldHRpbmdzU2VydmljZSc7XHJcblxyXG4gIHB1YmxpYyBsb2FkaW5nJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGFwcFNldHRpbmdzU3RvcmU6IEFwcFNldHRpbmdzU3RvcmUsXHJcbiAgICBwcml2YXRlIGFwcFNldHRpbmdzUXVlcnk6IEFwcFNldHRpbmdzUXVlcnksXHJcbiAgICBwcml2YXRlIGxvZ2dlcjogTG9nZ2luZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnRcclxuICApIHtcclxuICAgIGNvbnNvbGUubG9nKCdBcHBTZXR0aW5nc1NlcnZpY2UgQ29uc3RydWN0b3InKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRWYWx1ZShuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLmFwcFNldHRpbmdzUXVlcnkuaGFzRW50aXR5KG5hbWUpKSB7XHJcbiAgICAgIHRoaXMuYXBwU2V0dGluZ3NTdG9yZS51cGRhdGUobmFtZSwgeyBuYW1lOiBuYW1lLCB2YWx1ZTogdmFsdWUgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmFwcFNldHRpbmdzU3RvcmUuYWRkKHsgbmFtZTogbmFtZSwgdmFsdWU6IHZhbHVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChuYW1lID09PSBBcHBTZXR0aW5ncy5hcGlIb21lKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkRnJvbVNlcnZlcih2YWx1ZS50b1N0cmluZygpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRWYWx1ZShuYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgaWYgKHRoaXMuYXBwU2V0dGluZ3NRdWVyeS5oYXNFbnRpdHkobmFtZSkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYXBwU2V0dGluZ3NRdWVyeS5nZXRFbnRpdHkobmFtZSkudmFsdWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9hZEZyb21TZXJ2ZXIoYXBpSG9tZTogc3RyaW5nKSB7XHJcbiAgICAvLyBNYXJrIHN0b3JlIGFzIGxvYWRpbmdcclxuICAgIHRoaXMuYXBwU2V0dGluZ3NTdG9yZS5zZXRMb2FkaW5nKHRydWUpO1xyXG5cclxuICAgIC8vIExvYWQgdmFsdWVzIGZyb20gU2VydmVyXHJcbiAgICB0aGlzLmh0dHBcclxuICAgICAgICAuZ2V0PEFycmF5PEFwcFNldHRpbmdzVmFsdWU+PihgJHthcGlIb21lfS9hcGkvdjEvYXBwU2V0dGluZ3NgKVxyXG4gICAgICAgIC5waXBlKHRpbWVvdXQoMjAwMDApLCByZXRyeSgzKSlcclxuICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICBhcHBWYWx1ZXMgPT4ge1xyXG4gICAgICAgIGlmIChhcHBWYWx1ZXMpIHtcclxuICAgICAgICAgIGFwcFZhbHVlcy5mb3JFYWNoKGFwcFZhbHVlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShhcHBWYWx1ZS5uYW1lLCBhcHBWYWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hcHBTZXR0aW5nc1N0b3JlLnNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuYXBwU2V0dGluZ3NTdG9yZS51cGRhdGUoeyBpc0luaXRpYWxpc2VkOiB0cnVlIH0pO1xyXG4gICAgICB9LFxyXG4gICAgICBlcnIgPT4ge1xyXG4gICAgICAgIHRoaXMuYXBwU2V0dGluZ3NTdG9yZS5zZXRMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRWYWx1ZXMoc2V0dGluZ3M6IG9iamVjdCkge1xyXG4gICAgLy8gTWFyayBzdG9yZSBhcyBsb2FkaW5nXHJcbiAgICB0aGlzLmFwcFNldHRpbmdzU3RvcmUuc2V0TG9hZGluZyh0cnVlKTtcclxuICAgIHRoaXMuYXBwU2V0dGluZ3NTdG9yZS51cGRhdGUoeyBpc0luaXRpYWxpc2VkOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBMb2FkIHZhbHVlc1xyXG4gICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHNldHRpbmdzKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgLy8gU2V0dGluZyBWYWx1ZSBIZXJlXHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgWyR7dGhpcy5jbGFzc05hbWV9LmxvYWRTZXR0aW5nc10gU2V0dGluZyBWYWx1ZSAke2tleX0gPSAke3NldHRpbmdzW2tleV19YCk7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZShrZXksIHNldHRpbmdzW2tleV0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFwcFNldHRpbmdzU3RvcmUuc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB0aGlzLmFwcFNldHRpbmdzU3RvcmUudXBkYXRlKHsgaXNJbml0aWFsaXNlZDogdHJ1ZSB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRCb29sZWFuKG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIHRoaXMuYXBwU2V0dGluZ3NRdWVyeS5zZWxlY3RFbnRpdHkobmFtZSwgZW50aXR5ID0+IGVudGl0eS52YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0U3RyaW5nKG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5hcHBTZXR0aW5nc1F1ZXJ5LnNlbGVjdEVudGl0eShuYW1lLCBlbnRpdHkgPT4gZW50aXR5LnZhbHVlKTtcclxuICB9XHJcbn1cclxuIl19